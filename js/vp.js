function CallGetAvailablePokerGames(n){var i=BASEURL+"/api/dealer/games",t=[];$.ajax({url:i,type:"GET",headers:{Accept:"application/json"},dataType:"json",error:function(n,t,i){ShowError(n.responseText+"-"+i);DisableAll(!0)},success:function(i){for(var r=0;r<i.length;r++)t.push(new GameInfo(i[r]));n(t)}})}function CallGetUserFromGuid(n,t){var i=BASEURL+"/api/User/ByID",r=JSON.stringify({ID:n});$.ajax({url:i,type:"POST",data:r,contentType:"application/json",error:function(n,t,i){ShowError(n.responseText+"-"+i)},success:function(n){t(n)}})}function CallGetUserFromLogin(n,t,i){var r=BASEURL+"/api/User/ByLogin",u=JSON.stringify({NickName:n,Password:t});$.ajax({url:r,type:"POST",crossDomain:!0,data:u,dataType:"json",headers:{Accept:"application/json"},contentType:"application/json",error:function(n,t,i){ShowError(n.responseText+"-"+i)},success:function(n){i(n)}})}function CallAddUser(n,t){var i=BASEURL+"/api/User/AddUser",r=JSON.stringify(n);$.ajax({url:i,type:"POST",data:r,contentType:"application/json",error:function(n,t,i){ShowError(n.responseText+"-"+i)},success:function(n){t(n)}})}function CallUpdateUser(n,t){var i=BASEURL+"/api/User/UpdateUser",r=JSON.stringify(n);$.ajax({url:i,type:"POST",data:r,contentType:"application/json",error:function(n,t,i){ShowError(n.responseText+"-"+i)},success:function(n){t(n)}})}function CallPostSetUserPreferences(n,t){var i=BASEURL+"/api/User/SetPrefs",r=JSON.stringify({UserID:n,Preferences:t});$.ajax({url:i,type:"POST",data:r,contentType:"application/json",error:function(n,t,i){ShowError(n.responseText+"-"+i)},success:function(){}})}function CallGetGameStats(n,t,i){var r=BASEURL+"/api/User/GameStats",u=JSON.stringify({UserID:n,GameID:t});$.ajax({url:r,type:"POST",data:u,contentType:"application/json",error:function(n,t,i){ShowError(n.responseText+"-"+i)},success:function(n){i(n)}})}function CallStartHand(n,t){var i=BASEURL+"/api/Dealer/StartHand",r=JSON.stringify({UserID:mActiveUser.UserID,Mode:mActiveGame.GameID,BetAmount:n});$.ajax({url:i,type:"POST",data:r,contentType:"application/json",error:function(n,t,i){ShowError(n.responseText+"-"+i)},success:function(n){t(n)}})}function CallCompleteHand(n,t){var i=BASEURL+"/api/Dealer/CompleteHand",r=JSON.stringify({UserID:mActiveUser.UserID,Mode:mActiveGame.GameID,BetAmount:n,Hand:mActiveHand});$.ajax({url:i,type:"POST",data:r,contentType:"application/json",error:function(n,t,i){ShowError(n.responseText+"-"+i)},success:function(n){t(n)}})}function SetupAvailableGames(n){var t,i,r;for(mAvailableGames=n,t=0;t<n.length;t++)i=n[t],r="<button id='game"+t+"' onclick='SelectGame("+t+")'>"+i.Name+"<\/button><br/>",$(r).appendTo("#popupGameSelector")}function SetActiveGame(n){mActiveGame=n;$("#btnGameType").html(n.Name);ShowGameSelectionPopup(!1)}function SelectGame(n){SetActiveGame(mAvailableGames[n]);SaveCurrentGame()}function ShowWaitCursor(n){var t=n?"block":"none";$("#popupWaitCursor").css("display",t)}function ShowLoginPopup(n){var t=n?"block":"none";$("#popupLogin").css("display",t)}function ShowAccountPopup(n){var t=n?"block":"none";$("#popupAccount").css("display",t)}function ShowGameSelectionPopup(n){var t=n?"block":"none";$("#popupGameSelector").css("display",t)}function SetLoginErrorString(n){$("#loginErrorLabel").text(n)}function SetAccountErrorString(n){$("#accountErrorLabel").text(n)}function ValidateAccountInput(){var n=TestInput("#txtAccountFirst",3)&&TestInput("#txtAccountLast",3)&&TestInput("#txtAccountNickname",3)&&TestInput("#txtAccountEmail",6)&&TestInput("#txtAccountPassword1",5)&&TestInput("#txtAccountPassword2",5),t,i;return n?(t=$("#txtAccountPassword1").val(),i=$("#txtAccountPassword2").val(),t!=i)?($("#txtAccountPassword1").addClass("inputErrorState"),$("#txtAccountPassword2").addClass("inputErrorState"),SetAccountErrorString("Password mismatch"),!1):($("#txtAccountPassword1").removeClass("inputErrorState"),$("#txtAccountPassword2").removeClass("inputErrorState"),n):(SetAccountErrorString("Value is too short, operation cancelled"),!1)}function TestInput(n,t){var i=$(n).val();return i.length<t?($(n).addClass("inputErrorState"),!1):($(n).removeClass("inputErrorState"),!0)}function SetActiveUser(n){mActiveUser=n;ReadUserPreferences(n);ShowBankAmount();ShowUserInfo();SaveActiveUser()}function Login(n,t){SetLoginErrorString("");CallGetUserFromLogin(n,t,function(t){if(!t.TransactionSucceeded){SetLoginErrorString("Error: "+t.FailureInfo);return}SetActiveUser(t.User);SetLoginErrorString("");ShowLoginPopup(!1);ShowResults("Welcome "+n,"results");SetReady()})}function CheckForExistingUser(){var n=ReadActiveUserId();n!=null&&CallGetUserFromGuid(n,function(n){if(!n.TransactionSucceeded){ShowError(n.FailureInfo);return}SetActiveUser(n.User);ShowLoginPopup(!1);SetReady()})}function btnGameType_OnClick(){ShowGameSelectionPopup(!0)}function btnUser_OnClick(){mbCreateAccountMode=!1;$("#popupAccountTitle").text("Update User Account Information");$("#btnAccountSubmit").text("UPDATE");$("#btnAccountLogout").css("visibility","visible");$("#txtAccountFirst").val(mActiveUser.FirstName);$("#txtAccountLast").val(mActiveUser.LastName);$("#txtAccountNickname").val(mActiveUser.Nickname);$("#txtAccountPassword1").val(mActiveUser.Password);$("#txtAccountPassword2").val(mActiveUser.Password);$("#txtAccountEmail").val(mActiveUser.Email);ShowAccountPopup(!0)}function btnBank_OnClick(){}function btnDeal_OnClick(){switch(msState){case"ready":StartHand();break;case"discard1":mActiveGame.GameHas2Draws?MoveToNextDiscard():CompleteHand();break;case"discard2":CompleteHand()}}function btnResults_OnClick(){var n,t,i;if(mActiveUser!=null){n="results";switch(msResultsMode){case"results":lastResultsValue=$("#btnResults").html();n="gameStats";break;case"gameStats":n="gamePayoff";break;case"gamePayoff":n="generalHelp";break;case"generalHelp":n="results"}switch(n){case"results":ShowResults(lastResultsValue,"results");break;case"gameStats":CallGetGameStats(mActiveUser.UserID,mActiveGame.GameID,function(n){n.TransactionSucceeded?ShowResults(FormatGameStats(n.Stats),"gameStats"):ShowResults("Could not get retrieve statistics","gameStats")});break;case"gamePayoff":t="game"+mActiveGame.GameID+"help";i=window[t];ShowResults(i,"gamePayoff");break;case"generalHelp":ShowResults(generalhelp,"generalHelp")}}}function btnBet_OnClick(){}function btnBetPlus_OnClick(){mActiveUser!=null&&mdCurrentBetAmount+1<mActiveUser.Bank&&(mdCurrentBetAmount++,ShowBetAmount(),SaveCurrentBetAmount())}function btnBetMinus_OnClick(){mActiveUser!=null&&mdCurrentBetAmount-1>=1&&(mdCurrentBetAmount--,ShowBetAmount(),SaveCurrentBetAmount())}function btnLoginSubmit_OnClick(){var i=TestInput("#txtLoginName",3)&&TestInput("#txtLoginPassword",5),n,t;if(!i){SetLoginErrorString("Input error - insufficient text length");return}n=$("#txtLoginName").val();t=$("#txtLoginPassword").val();Login(n,t)}function btnLoginCreate_OnClick(){mbCreateAccountMode=!0;$("#popupAccountTitle").text("Create New User Account");$("#btnAccountSubmit").html("CREATE");$("#btnAccountLogout").css("visibility","hidden");$("#txtAccountFirst").val("");$("#txtAccountLast").val("");$("#txtAccountNickname").val("");$("#txtAccountPassword1").val("");$("#txtAccountPassword2").val("");$("#txtAccountEmail").val("");$("#txtAccountFirst").removeClass("inputErrorState");$("#txtAccountLast").removeClass("inputErrorState");$("#txtAccountNickname").removeClass("inputErrorState");$("#txtAccountPassword1").removeClass("inputErrorState");$("#txtAccountPassword2").removeClass("inputErrorState");$("#txtAccountEmail").removeClass("inputErrorState");SetAccountErrorString("");ShowAccountPopup(!0);ShowLoginPopup(!1)}function btnAccountSubmit_OnClick(){if(SetAccountErrorString(""),ValidateAccountInput())if(mbCreateAccountMode)CallAddUser({FirstName:$("#txtAccountFirst").val(),LastName:$("#txtAccountLast").val(),Nickname:$("#txtAccountNickname").val(),Password:$("#txtAccountPassword1").val(),Email:$("#txtAccountEmail").val()},function(n){if(!n.TransactionSucceeded){SetAccountErrorString("Error: "+n.FailureInfo);return}SetActiveUser(n.User);ShowAccountPopup(!1);ShowLoginPopup(!1);ShowResults("Welcome "+n.User.Nickname,"results");SetReady()});else{var n={UserID:mActiveUser.UserID,FirstName:$("#txtAccountFirst").val(),LastName:$("#txtAccountLast").val(),Nickname:$("#txtAccountNickname").val(),Password:$("#txtAccountPassword1").val(),Email:$("#txtAccountEmail").val()};CallUpdateUser(n,function(t){if(!t.TransactionSucceeded){SetAccountErrorString("Error: "+t.FailureInfo);return}mActiveUser.FirstName=n.FirstName;mActiveUser.LastName=n.LastName;mActiveUser.Nickname=n.Nickname;mActiveUser.Password=n.Password;mActiveUser.Email=n.Email;ShowAccountPopup(!1);ShowUserInfo();ShowResults("User info update complete","results")})}}function btnAccountCancel_OnClick(){ShowAccountPopup(!1);mbCreateAccountMode&&ShowLoginPopup(!0)}function btnAccountLogout_OnClick(){ShowAccountPopup(!1);mPlayStats=new PlayStats;mActiveUser=null;mActiveDeck=null;mActiveHand=null;mdCurrentBetAmount=DEFAULT_BET_AMOUNT;msState="pending";msResultsMode="results";SaveActiveUser();DisableAll(!0);ShowResults("","results");$("#txtLoginName").val("");$("#txtLoginPassword").val("");ShowLoginPopup(!0)}function ReadUserPreferences(n){var t,i,r,u,e,f;if(SetActiveGame(mAvailableGames[0]),mdCurrentBetAmount=DEFAULT_BET_AMOUNT,ShowBetAmount(),n.Preferences!=null)for(t=0;t<n.Preferences.length;t++){i=n.Preferences[t];switch(i.Name){case"vpCurrentGame":if(r=parseInt(i.Value),r!=NaN&&r>0)for(u=0;u<mAvailableGames.length;u++)if(e=mAvailableGames[u],e.GameID==r){SetActiveGame(e);break}break;case"vpCurrentBet":f=parseInt(i.Value);f!=NaN&&f>0&&(mdCurrentBetAmount=f,ShowBetAmount())}}}function SaveCurrentGame(){CallPostSetUserPreferences(mActiveUser.UserID,[{Name:"vpCurrentGame",Value:mActiveGame.GameID.toString()}])}function SaveCurrentBetAmount(){CallPostSetUserPreferences(mActiveUser.UserID,[{Name:"vpCurrentBet",Value:mdCurrentBetAmount.toString()}])}function SaveActiveUser(){mActiveUser==null?ClearCookies():($.cookie("vpUserId",mActiveUser.UserID),$.cookie("vpUserNickname",mActiveUser.Nickname))}function ReadActiveUserId(){return $.cookie("vpUserId")}function ClearCookies(){$.removeCookie("vpUserId");$.removeCookie("vpUserNickname")}function SetReady(){msState="ready";DisableMidGameButtons(!1)}function StartHand(){msState="pending";DisableMidGameButtons(!0);ShowResults("","results");ShowWaitCursor(!0);CallStartHand(mdCurrentBetAmount,function(n){var i,t;if(!n.TransactionSucceeded){ShowError(n.FailureInfo);DisableMidGameButtons(!1);SetCardsToBack();msState="pending";ShowWaitCursor(!1);return}for(mActiveDeck=[],mActiveHand=[],mActiveUser.Bank-=mdCurrentBetAmount,ShowBankAmount(),t=0;t<HANDCARDS;t++)i=new CardInfo(n.Deck[t]),mActiveHand.push(i),ShowCard(i,t+1);for(t=HANDCARDS;t<n.Deck.length;t++)mActiveDeck.push(new CardInfo(n.Deck[t]));msState="discard1";ShowResultsComment("Play discard");DisableDealButton(!1);$(".card").css("cursor","pointer");ShowWaitCursor(!1)})}function MoveToNextDiscard(){ReplaceRequested();msState="discard2";ShowResultsComment("Play discard 2")}function CompleteHand(){ReplaceRequested();DisableDealButton(!0);ShowWaitCursor(!0);CallCompleteHand(mdCurrentBetAmount,function(n){if(!n.TransactionSucceeded){ShowError(n.FailureInfo);DisableMidGameButtons(!1);ShowWaitCursor(!1);SetCardsToBack();msState="pending";return}mActiveUser.Bank=n.CurrentUserBank;mPlayStats.HandsPlayed++;mPlayStats.TotalBet+=n.AmountBet;mPlayStats.TotalWon+=n.AmountWon;ShowBankAmount();ShowResults(n.HandName,"results");msState="ready";DisableMidGameButtons(!1);$(".card").css("cursor","default");ShowWaitCursor(!1)})}function ReplaceRequested(){for(var t,n=0;n<HANDCARDS;n++)t=mActiveHand[n],t.MarkedForDiscard&&(mActiveHand[n]=mActiveDeck.shift(),ShowCard(mActiveHand[n],n+1))}function ShowCard(n,t){var r="#card"+t,i="images/cards/"+n.ResFile;n.MarkedForDiscard&&(i="images/cards/BackRed.png");$(r).attr("src",i)}function PlayDiscard(n,t){if(msState=="discard1"||msState=="discard2"){var i=mActiveHand[t-1];i.MarkedForDiscard=!i.MarkedForDiscard;ShowCard(i,t)}}function ShowBetAmount(){$("#btnBet").html("$"+mdCurrentBetAmount+".00")}function ShowBankAmount(){$("#btnBank").html("$"+Format2Digits(mActiveUser.Bank))}function ShowUserInfo(){$("#btnUser").html(mActiveUser.FirstName+" "+mActiveUser.LastName)}function ShowResults(n,t){$("#btnResults").html(n);msResultsMode=t}function ShowError(n){var t="<div class='errorStateDiv'>"+n+"<\/div>";ShowResults(t,"results")}function ShowResultsComment(n){var t="<div class='commentStateDiv'>"+n+"<\/div>";ShowResults(t,"results")}function FormatGameStats(n){return"<table class='GameStats'><tr><th colspan='5' class='GamePayoffTitle'>"+n.GameName+" Statistics<\/th><\/tr><tr><th>Hands played:<\/th><td>"+n.TotalHandsPlayed+"<\/td><th>Hands won:<\/th><td>"+n.TotalHandsWon+"<\/td><\/tr><tr><th>Amount bet:<\/th><td>$"+Format2Digits(n.TotalBet)+"<\/td><th>Amount won:<\/th><td>$"+Format2Digits(n.TotalAmountWon)+"<\/td><\/tr><tr><th>Win percent:<\/th><td>"+n.PercentageWon+"%<\/td><th>Return percent:<\/th><td>"+n.ReturnPercentage+"%<\/td><\/tr><\/table>"}function DisableMidGameButtons(n){$("#btnDeal").prop("disabled",n);$("#btnGameType").prop("disabled",n);$("#btnBetPlus").prop("disabled",n);$("#btnBetMinus").prop("disabled",n);$("#btnBet").prop("disabled",n);$("#btnUser").prop("disabled",n);$("#btnBank").prop("disabled",n);var t=n?"default":"pointer";$("#btnGameType").css("cursor",t);$("#btnBetPlus").css("cursor",t);$("#btnBetMinus").css("cursor",t);$("#btnBet").css("cursor",t);$("#btnUser").css("cursor",t);$("#btnBank").css("cursor",t)}function DisableDealButton(n){$("#btnDeal").prop("disabled",n)}function DisableAll(){DisableMidGameButtons(!0);SetCardsToBack()}function Format2Digits(n){return parseFloat(Math.round(n*100)/100).toFixed(2)}function SetCardsToBack(){$(".card").attr("src","images/cards/BackRed.png");$(".card").css("cursor","default")}function SetInitialCardState(){DisableMidGameButtons(!0);ShowBetAmount();SetCardsToBack();$(".card").click(function(n){var t=$(n.target)[0].id,i=parseInt(t.charAt(4));PlayDiscard("#"+t,i)});$("#popupGameSelectorTitle").click(function(){ShowGameSelectionPopup(!1)});ShowResults("","results");CheckForExistingUser()}var HANDCARDS=5,DEFAULT_BET_AMOUNT=2,BASEURL="http://bengalcore.azurewebsites.net",mPlayStats=new PlayStats,mAvailableGames,mActiveGame,mActiveUser,mActiveDeck,mActiveHand,mdCurrentBetAmount=DEFAULT_BET_AMOUNT,mbCreateAccountMode=!0,lastResultsValue="",msState="none",msResultsMode="results"